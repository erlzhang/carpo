$(".book-chapter-container").html("<%= escape_javascript(render :partial => 'information')%>")
/*双击修改卷描述*/
$(".volume-description").on("dblclick",function() {
  event.preventDefault();
  var originalText = this.innerText 
  if($(this).hasClass("hint")){
    this.innerText = ""  
  }  
  this.contentEditable = true
  this.focus()
  this.onblur = function(){
    newText = this.innerText;
    if( newText == ""  ){
      this.innerText = originalText
    }else if( newText != originalText ){
      if( $(this).hasClass("hint")  ) {
        $(this).removeClass("hint")
      }
      /*Ajax修改卷名*/
      console.log("The volume name should be changed!")
      var url = window.location.href + "/volumes/" + this.getAttribute("data-volume") + "/update_description"
      $.ajax({
        type: "get",
        url: url,
        data: {
          description: newText 
        },
        success: function() {
          console.log("success")
        },
        error: function() {
          console.log("error")
        }
      });
    }
    this.contentEditable = false
  }
});
/*创建文章拖动感应区*/
var postList = document.getElementsByClassName("chapter")
$(postList).each(function(){
  var post_id = this.id.slice(5);
  this.ondragstart = function(event) { 
    console.log("drag start")
    event.dataTransfer.setData('text/plain', event.target.id)
    event.dataTransfer.dropEffect = "copy"
  }
  var drag = document.createElement("li");
})
var postDragList = $(".post-drag")
postDragList.each(function(){
  this.ondragover = function(){
    event.preventDefault();
    event.dataTransfer.dropEffect = "copy";
  }
  this.ondragenter = function(){
    event.preventDefault();
    $(event.target).addClass("on")
    event.dataTransfer.dropEffect = "copy";
  }
  this.ondragleave = function(){
    event.preventDefault();
    $(event.target).removeClass("on")
    event.dataTransfer.dropEffect = "copy";
    }
  this.ondrop = function(){
    event.preventDefault();
    /*Ajax文章排序，成功后进行后续操作*/
    var data = event.dataTransfer.getData("text");  
    $(event.target).removeClass("on")
    $("#" + data).insertBefore(event.target);
    $("#drag-" + data).insertBefore($("#" + data));
  }
});
